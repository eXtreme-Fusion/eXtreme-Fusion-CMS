<?php/*********************************************************| eXtreme-Fusion 5| Content Management System|| Copyright (c) 2005-2013 eXtreme-Fusion Crew| http://extreme-fusion.org/|| This program is released as free software under the| Affero GPL license. You can redistribute it and/or| modify it under the terms of this license which you| can read by viewing the included agpl.txt or online| at www.gnu.org/licenses/agpl.html. Removal of this| copyright header is strictly prohibited without| written permission from the original author(s).| **********************************************************                ORIGINALLY BASED ON---------------------------------------------------------| PHP-Fusion Content Management System| Copyright (C) 2002 - 2011 Nick Jones| http://www.php-fusion.co.uk/+-------------------------------------------------------| Author: Nick Jones (Digitanium)+-------------------------------------------------------| This program is released as free software under the| Affero GPL license. You can redistribute it and/or| modify it under the terms of this license which you| can read by viewing the included agpl.txt or online| at www.gnu.org/licenses/agpl.html. Removal of this| copyright header is strictly prohibited without| written permission from the original author(s).+-------------------------------------------------------*/require_once '../../system/sitecore.php';try{	if ($_request->post('message_subject')->show())	{		$item_id = $_pdo->getField('SELECT max(`item_id`) FROM [messages]');		$subject = $_request->post('message_subject')->show();		$subject = HELP::strip($subject);	}	else	{		$item_id = $_request->post('item_id')->isNum(TRUE);		$subject = '';	}		if ($_request->post('send')->show() && iUSER && $_request->post('message')->show() != '' && isNum($_request->post('to')->show())) 	{		$result = $_pdo->exec('INSERT INTO [messages] (`to`, `from`, `item_id`, `message`, `subject`, `datestamp`) VALUES (:to, :from, :item_id, :message, :subject, :datestamp)',			array(				array(':to', $_request->post('to')->show(), PDO::PARAM_INT),				array(':from', $_user->get('id'), PDO::PARAM_INT),				array(':item_id', $item_id, PDO::PARAM_INT),				array(':subject', $subject, PDO::PARAM_STR),				array(':message', $_request->post('message')->strip(), PDO::PARAM_STR),				array(':datestamp', time(), PDO::PARAM_INT)			)		);	}		if ($_request->post('message_subject')->show())	{		_e($item_id);	}}catch(optException $exception){  optErrorHandler($exception);}catch(systemException $exception){  systemErrorHandler($exception);}catch(userException $exception){  userErrorHandler($exception);}catch(PDOException $exception){  PDOErrorHandler($exception);}